function lineGraph(e,t){_self=this;this.fvParams={rate:.03,weeklyContribution:10,startAge:15,endAge:65,offsetMonths:0};this.container=d3.select(e);this.data=this.futureValueWeekly(this.fvParams);this.vData=this.data;this.pData=[];this.dotSize=8;this.datalength=this.data.length;this.w=this.stripPx(this.container.style("width"));this.h=this.stripPx(this.container.style("height"));this.padding={left:60,right:30,top:30,bottom:50};this.innerWidth=this.w-this.padding.left-this.padding.right;this.innerHeight=this.h-this.padding.top-this.padding.bottom;this.innerTop=this.h-this.padding.top;this.innerRight=this.w-this.padding.right;var n=5;this.setScales();this.setAxes();this.svg=this.container.append("svg").attr({width:this.w,height:this.h,"class":"lineGraph"});this.svg.append("defs").append("clipPath").attr("id","clip").append("svg:rect").attr({x:this.padding.left+n,y:0,width:this.innerWidth-n,height:this.innerHeight});this.chartBody=this.svg.append("g").attr("clip-path","url(#clip)").attr("class","chartBody");this.svg.append("g").attr({"class":"x axis",transform:"translate(0,"+(this.h-this.padding.bottom)+")"}).call(this.xA);this.svg.append("g").attr({"class":"y axis",transform:"translate("+this.padding.left+","+0+")"}).call(this.yA);this.line=d3.svg.line().x(function(e){return _self.xs(e.WEEK)}).y(function(e){return _self.ys(e.FV)});this.path=this.svg.append("path").attr("class","line selection");this.proj=this.svg.append("path").attr("class","line projection").attr("stroke-dasharray","5,5");this.dot=this.svg.append("circle").attr("class","datum").attr("r",this.dotSize);this.dotLabel=this.svg.append("text").attr("class","label dot").attr("text-anchor","middle");this.container.append("div").attr("class","slider age");$(".slider.age").slider({range:!0,min:0,max:_self.datalength,values:[0,_self.datalength],slide:function(e,t){if($(t.handle).hasClass("locked"))return!1;_self.sliceData(t.values[0],t.values[1]);_self.drawLines();return!0}}).css({"margin-left":this.padding.left,"margin-right":this.padding.right});this.svg.append("text").attr("class","label").text("Age").attr({x:this.w/2,y:this.h-this.padding.bottom/3});this.drawLines()}lgp=lineGraph.prototype;lgp.setScales=function(){this.xs=d3.scale.linear().range([this.padding.left,this.innerRight]).domain(d3.extent(this.data,function(e){return+e.WEEK}));this.ys=d3.scale.linear().range([this.h-this.padding.bottom,this.padding.top]).domain(d3.extent(this.data,function(e){return+e.FV}))};lgp.setAxes=function(){this.xA=d3.svg.axis().scale(this.xs).orient("bottom").ticks(this.datalength/52/5).tickFormat(function(e){o=_self.data[e];return o.AGE});this.yA=d3.svg.axis().scale(this.ys).orient("left").tickFormat(function(e){return finance.format(e,"USD")})};lgp.sliceData=function(e,t){if(e!=this.fvParams.offsetMonths){console.log("getting data");this.fvParams.offsetMonths=e;this.data=this.futureValueWeekly(this.fvParams)}console.log("slicing min/max: "+e+" / "+t);this.vData=this.data.slice(e,t);this.pData=this.data.slice(t,this.data.length)};lgp.drawLines=function(){this.path.datum(this.vData).attr("d",this.line);this.proj.datum(this.pData).attr("d",this.line);lastDatum=this.vData[this.vData.length-1];console.log(lastDatum);this.dot.attr({cx:_self.xs(lastDatum.WEEK),cy:_self.ys(lastDatum.FV)});this.dotLabel.attr({x:_self.xs(lastDatum.WEEK),y:_self.ys(lastDatum.FV)-this.dotSize-2}).text(finance.format(lastDatum.FV,"USD"))};lgp.stripPx=function(e){i=e.indexOf("px");return+e.slice(0,i)};lgp.futureValueWeekly=function(e){var t=new Array;e.years=e.endAge-e.startAge;e.weeks=e.years*52;e.FV=0;e.lastV=0;e.age=e.startAge;e.weekRate=e.rate/52;console.log(e);for(i=0;i<=e.weeks;i++){e.FV=i>e.offsetMonths?(e.lastV+e.weeklyContribution)*(1+e.weekRate):0;o={};o.FV=e.FV;o.AGE=e.age;o.WEEK=i;t.push(o);i%52==1&&(e.age+=1);e.lastV=e.FV}return t};