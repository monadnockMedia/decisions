function savingsGraph(e,t){_self=this;this.fvParams={rate:.03,weeklyContribution:10,startAge:15,endAge:65,offsetMonths:0};this.chartState=JSON.parse(JSON.stringify(this.fvParams));this.sliderP={rate:{min:1,max:7},contribution:{min:0,max:100}};this.container=d3.select(e);this.data=this.futureValueWeekly(this.fvParams);this.ages=this.collapseAges(this.data.map(function(e){return e.AGE}));this.vData=this.data;this.pData=[];this.dotSize=8;this.datalength=this.data.length;this.lastDatum=this.data[this.datalength-1];this.firstDatum=this.data[0];this.weekRange={min:this.firstDatum.WEEK,max:this.lastDatum.WEEK};this.w=this.stripPx(this.container.style("width"));this.h=this.stripPx(this.container.style("height"));this.padding={left:60,right:30,top:30,bottom:50};this.innerWidth=this.w-this.padding.left-this.padding.right;this.innerHeight=this.h-this.padding.top-this.padding.bottom;this.innerTop=this.h-this.padding.top;this.innerRight=this.w-this.padding.right;var n=5;this.setScales();this.setAxes();this.svg=this.container.append("svg").attr({width:this.w,height:this.h,"class":"lineGraph"});this.svg.append("defs").append("clipPath").attr("id","clip").append("svg:rect").attr({x:this.padding.left+n,y:0,width:this.innerWidth-n,height:this.innerHeight});this.chartBody=this.svg.append("g").attr("clip-path","url(#clip)").attr("class","chartBody");this.addAxes();this.line=d3.svg.line().x(function(e){return _self.xs(e.WEEK)}).y(function(e){return _self.ys(e.FV)});this.path=this.svg.append("path").attr("class","line selection");this.proj=this.svg.append("path").attr("class","line projection").attr("stroke-dasharray","5,5");this.xBar=this.svg.append("line").attr("class","x bar").attr("stroke-dasharray","2,4");this.yBar=this.svg.append("line").attr("class","y bar").attr("stroke-dasharray","2,4");this.dot=this.svg.append("circle").attr("class","datum").attr("r",this.dotSize);this.dotLabel=this.svg.append("text").attr("class","label dot").attr("text-anchor","middle");this.buildSliders();this.svg.append("text").attr("class","label").text("Age").attr({x:this.w/2,y:this.h-this.padding.bottom/3});this.drawLines()}lgp=savingsGraph.prototype;lgp.setScales=function(){this.xs=d3.scale.linear().range([this.padding.left,this.innerRight]).domain(d3.extent(this.data,function(e){return+e.WEEK}));this.xs2=d3.scale.linear().range([this.padding.left,this.innerRight]).domain(d3.extent(this.ages,function(e){return+e}));this.ys=d3.scale.linear().range([this.h-this.padding.bottom,this.padding.top]).domain(d3.extent(this.data,function(e){return+e.FV}))};lgp.updateScales=function(){this.ys.domain(d3.extent(this.data,function(e){return+e.FV}))};lgp.setAxes=function(){this.xA2=d3.svg.axis().scale(this.xs2).orient("bottom").ticks(50);this.xA=d3.svg.axis().scale(this.xs).orient("bottom").ticks(50).tickFormat(function(e){o=_self.data[e];return o.AGE});this.yA=d3.svg.axis().scale(this.ys).orient("left").tickFormat(function(e){return finance.format(e,"USD")})};lgp.addAxes=function(){this.svg.append("g").attr({"class":"x axis",transform:"translate(0,"+(this.h-this.padding.bottom)+")"}).call(this.xA2).selectAll("text").attr("class","x tick").each(function(){check=+this.textContent%5!=0;d3.select(this).classed("hidden",check)});this.svg.append("g").attr({"class":"y axis",transform:"translate("+this.padding.left+","+0+")"}).call(this.yA)};lgp.updateAxes=function(){this.yA.scale(this.ys);this.svg.select(".y.axis").call(this.yA)};lgp.buildSliders=function(){this.container.append("div").attr({"class":"tooltip"}).append("h1");this.container.append("div").attr({"class":"slider age",title:"Age"});this.container.append("div").attr({"class":"slider contribution",title:"$"});this.container.append("div").attr({"class":"slider rate",title:"Rate"});$(".slider").css({"margin-left":this.padding.left,"margin-right":this.padding.right});var e=10,t;$(".slider").slider({start:function(e,t){n(t);i();$(this)}});$(".slider.age").slider({range:!0,min:0,max:_self.datalength,values:[0,_self.datalength],start:null,slide:function(n,r){t=Math.ceil((r.values[1]-r.values[0])/52);if($(r.handle).hasClass("locked"))return!1;if(t<=e){console.log("minSpan");hI=+(r.value==r.values[1]);hT=+!hI;console.log(r.values[hT]!=_self.datalength);if(r.values[hT]==0||r.values[hT]>=_self.datalength)return!1;var i=hI==0?r.value+e*52:r.value-e*52;$(this).slider("values",hT,i)}_self.weekRange.min=r.values[0];_self.weekRange.max=r.values[1];_self.redraw();return!0}});var n=function(e,t){var n=$(e.handle).offset(),r=$(e.handle).width()/2;console.log(r);$(".tooltip").css({top:n.top,left:+n.left+r}).html(t)},r=function(){$(".tooltip").animate({opacity:0})},i=function(){$(".tooltip").animate({opacity:1})};$(".slider.contribution").slider({min:this.sliderP.contribution.min,max:this.sliderP.contribution.max,value:_self.fvParams.weeklyContribution,slide:function(e,t){n(t,"$"+t.value);_self.fvParams.weeklyContribution=t.value;_self.redraw()},stop:function(e,t){$(this).find(".ui-slider-handle").text("$"+t.value);r()}});$(".slider.rate").slider({min:this.sliderP.rate.min,max:this.sliderP.rate.max,step:.1,value:_self.fvParams.rate*100,slide:function(e,t){n(t,t.value+"%");_self.fvParams.rate=t.value/100;_self.redraw()},stop:function(e,t){$(this).find(".ui-slider-handle").text(t.value+"%");r()}})};lgp.redraw=function(){this.update&&(_self.data=_self.futureValueWeekly(_self.fvParams));_self.updateAxes();_self.sliceData();this.lastDatum=this.vData[this.vData.length-1];this.firstDatum=this.vData[0];_self.updateScales();this.svg.selectAll(".x.tick").each(function(){checkLast=this.textContent==_self.lastDatum.AGE;checkFirst=this.textContent==_self.firstDatum.AGE;d3.select(this).classed("active",checkLast||checkFirst);d3.select(this).classed("last",checkLast);d3.select(this).classed("first",checkFirst)});_self.drawLines();this.chartState=JSON.parse(JSON.stringify(this.fvParams))};lgp.update=function(){var e=this.fvParams,t=this.chartState,n=null;for(var r in t){att=e[r];st=t[r];if(att!=st){console.log("mismatch");n=!0;break}}return n};lgp.sliceData=function(){p=this.weekRange;if(p.min!=this.fvParams.offsetMonths){this.fvParams.offsetMonths=p.min;this.data=this.futureValueWeekly(this.fvParams)}this.vData=this.data.slice(p.min,p.max);this.pData=this.data.slice(p.max,this.data.length)};lgp.drawLines=function(){this.path.datum(this.vData).attr("d",this.line);this.proj.datum(this.pData).attr("d",this.line);datumX=this.xs(this.lastDatum.WEEK);datumY=this.ys(this.lastDatum.FV);this.dot.attr({cx:datumX,cy:datumY});this.dotLabel.attr({x:datumX,y:datumY-this.dotSize-2}).text(finance.format(this.lastDatum.FV,"USD"));this.xBar.attr({x1:datumX,y1:this.ys(0),x2:datumX,y2:datumY});this.yBar.attr({x1:this.xs(0),y1:datumY,x2:datumX,y2:datumY})};lgp.stripPx=function(e){i=e.indexOf("px");return+e.slice(0,i)};lgp.collapseAges=function(e){var t=[],n;e.sort();for(var r=0;r<e.length;r++){e[r]!==n&&t.push(e[r]);n=e[r]}return t};lgp.futureValueWeekly=function(e){var t=new Array,n=e.endAge-e.startAge,r=n*52,s=0,u=0,a=e.startAge,f=e.rate/52;for(i=0;i<=r;i++){s=i>e.offsetMonths?(u+e.weeklyContribution)*(1+f):0;o={};o.FV=s;o.AGE=a;o.WEEK=i;t.push(o);(i+1)%52==0&&(a+=1);u=s}return t};